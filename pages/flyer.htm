url = "/project-materials"
layout = "default"
title = "Project materials"
is_hidden = 0
robot_index = "index"
robot_follow = "follow"
header_image = "media.jpg"

[builderList mediaFlyersList]
modelClass = "pensoft\Media\Models\Flyers"
scope = "-"
scopeValue = "{{ :scope }}"
displayColumn = "name"
noRecordsMessage = "No records found"
detailsPage = "-"
detailsUrlParameter = "id"
pageNumber = "{{ :page }}"
==
<?php
use Pensoft\Media\Models\Flyers;
use Pensoft\Media\Models\Category;

use System\Models\File;

function onFilterFlyers()
{
    $categoryId = post('flyerType');

    if ($categoryId === 'all') {
        $this['mediaFlyersList'] = Flyers::get();
    } else {
        $this['mediaFlyersList'] = Flyers::where('category_id', $categoryId)->get();
    }
}

function onStart(){
    $this['categories'] = Category::orderBy('sort_order')->get();
	$this['mediaFlyersList'] =  Flyers::get();
	if(get('download')){
		$file = File::find((int)get('download'));
		$file_name = $file->getLocalPath();
$recordName = get('file_name') ? get('file_name') : 'ForestPaths_flyer';
$ext= $file->getExtension();

if (file_exists($file_name)) {
header('Content-Description: File Transfer');
header('Content-Type: application/octet-stream');
header("Content-Type: application/force-download");
header('Content-Disposition: attachment; filename='.$recordName .'.'. $ext);
header('Content-Transfer-Encoding: binary');
header('Expires: 0');
header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
header('Pragma: public');
header('Content-Length: ' . filesize($file_name));
ob_clean();
flush();
readfile($file_name);
exit();
}
return Redirect::to('/media-center/flyer');
}

}
?>
==
<main id="main-content" role="main">
    <section class="container flyer-container" aria-labelledby="flyers-heading">
        <h1 id="flyers-heading" class="underline">Promotional materials</h1>
        <div class="flyer-records" id="flyer-records">
            <div class="row mb-4">
                {% set records = mediaFlyersList %}
                {% set displayColumn = mediaFlyersList.displayColumn %}
                {% set noRecordsMessage = mediaFlyersList.noRecordsMessage %}
                {% set detailsPage = mediaFlyersList.detailsPage %}
                {% set detailsKeyColumn = mediaFlyersList.detailsKeyColumn %}
                {% set detailsUrlParameter = mediaFlyersList.detailsUrlParameter %}

                {% for record in records|sort((a, b) => a.name <=> b.name) %}
                {# Use spaceless tag to remove spaces inside the A tag. #}
                {% spaceless %}
                <article class="col-md-3 col-xs-12 center-xs">
                    <div class="logo_container">
                        <img src="{{record.flyer_image.path}}" alt="{{record.name}} promotional material">
                    </div>

                    <div class="col-xs-12">
                        <div class="text-center">
                            <h2 class="record-name">{{record.name}}</h2>
                            {% if record.file_lang_versions %}
                            <div class="dropdown-button">
                                <button class="btn btn-primary dropdown-toggle"
                                        aria-expanded="false"
                                        aria-haspopup="true"
                                        aria-label="Download {{record.name}} - select language">
                                    Download
                                    <img src="{{'arrow.svg'|media}}" alt="" aria-hidden="true" class="dropdown-arrow">
                                </button>
                                <div class="dropdown-content" role="menu" hidden>
                                    {% for item in record.file_lang_versions %}
                                    <a href="{{item.path}}"
                                       role="menuitem"
                                       target="_blank"
                                       rel="noopener noreferrer"
                                       aria-label="Download {{record.name}} in {{item.title}} (opens in new window)">{{item.title}}</a>
                                    {% endfor %}
                                </div>
                            </div>
                            {% else %}
                            <a href="{{record.file.path}}#file_name={{record.file.file_name}}"
                               class="btn btn-primary"
                               target="_blank"
                               rel="noopener noreferrer"
                               aria-label="Download {{record.name}} (opens in new window)">Download</a>
                            {% endif %}
                        </div>
                    </div>

                </article>


                {% endspaceless %}
                {% else %}
                <div class="col-xs-12 text-center" role="status">
                    <p>{{ noRecordsMessage }}</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>
</main>
